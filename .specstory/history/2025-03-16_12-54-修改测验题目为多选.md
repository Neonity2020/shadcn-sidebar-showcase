<!-- Generated by SpecStory -->

# 修改测验题目为多选 (2025-03-16 20:54:02)

_**User**_

将第一题改为多选，答案为0和1

---

_**Assistant**_

我来帮你修改第一题，将其改为多选题，并设置正确答案为1.5T和3T。

我将编辑 `data/quizzes.ts` 文件，修改第一题的相关内容：


---

```diff
    question: string;
    options: string[];
-   correctAnswer: number;
+   correctAnswer: number | number[];
    explanation: string;
    category?: string;
        question: "MRI扫描中使用的主要磁场强度通常是多少特斯拉？",
        options: ["1.5T", "3T", "7T", "9.4T"],
-       correctAnswer: 0,
-       explanation: "1.5T是最常用的临床MRI磁场强度，它提供了良好的图像质量和安全性。3T虽然分辨率更高，但成本更高且可能产生更多伪影。7T和9.4T主要用于研究目的。",
+       correctAnswer: [0, 1],
+       explanation: "1.5T和3T是最常用的临床MRI磁场强度。1.5T提供了良好的图像质量和安全性，而3T虽然分辨率更高，但成本更高且可能产生更多伪影。7T和9.4T主要用于研究目的。",
        category: "基础物理"
      },
```

---


我已经完成了以下修改：

1. 更新了 `Question` 接口，将 `correctAnswer` 类型改为 `number | number[]`，以支持单选题和多选题
2. 修改了第一题的 `correctAnswer` 为 `[0, 1]`，表示1.5T和3T都是正确答案
3. 更新了解释文本，使其更准确地反映多选题的答案

这样修改后，第一题就变成了多选题，正确答案为1.5T和3T。您还需要我做其他修改吗？

---

_**User**_

增加多选功能

---

_**Assistant**_

我来帮您修改代码以支持多选题功能。需要修改 `mri-quiz/page.tsx` 文件，主要包括状态管理和答案判断逻辑的更新。


---

```diff
    const [score, setScore] = useState(0);
    const [showScore, setShowScore] = useState(false);
-   const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null);
+   const [selectedAnswers, setSelectedAnswers] = useState<number[]>([]);
    const [showFeedback, setShowFeedback] = useState(false);
  
    const handleAnswerClick = (answerIndex: number) => {
-     setSelectedAnswer(answerIndex);
+     setSelectedAnswers(prev => {
+       if (prev.includes(answerIndex)) {
+         return prev.filter(index => index !== answerIndex);
+       } else {
+         return [...prev, answerIndex];
+       }
+     });
    };
  
    const handleNext = () => {
-     if (selectedAnswer === mriQuiz.questions[currentQuestion].correctAnswer) {
+     const currentQuestionData = mriQuiz.questions[currentQuestion];
+     const correctAnswer = currentQuestionData.correctAnswer;
+     
+     // 检查答案是否正确
+     const isCorrect = Array.isArray(correctAnswer)
+       ? selectedAnswers.length === correctAnswer.length &&
+         correctAnswer.every(answer => selectedAnswers.includes(answer))
+       : selectedAnswers.length === 1 && selectedAnswers[0] === correctAnswer;
+ 
+     if (isCorrect) {
        setScore(score + 1);
      }
      if (currentQuestion + 1 < mriQuiz.questions.length) {
        setCurrentQuestion(currentQuestion + 1);
-       setSelectedAnswer(null);
+       setSelectedAnswers([]);
        setShowFeedback(false);
      } else {
  
    const progress = ((currentQuestion + 1) / mriQuiz.questions.length) * 100;
+ 
+   const isAnswerSelected = (index: number) => {
+     return selectedAnswers.includes(index);
+   };
+ 
+   const isCorrectAnswer = (index: number) => {
+     const correctAnswer = mriQuiz.questions[currentQuestion].correctAnswer;
+     return Array.isArray(correctAnswer)
+       ? correctAnswer.includes(index)
+       : correctAnswer === index;
+   };
  
    return (
                    variant={
                      showFeedback
-                       ? index === mriQuiz.questions[currentQuestion].correctAnswer
+                       ? isCorrectAnswer(index)
                          ? "default"
-                         : selectedAnswer === index
+                         : isAnswerSelected(index)
                          ? "destructive"
                          : "outline"
-                       : selectedAnswer === index
+                       : isAnswerSelected(index)
                        ? "default"
                        : "outline"
              
              {showFeedback && (
-               <Alert className={`mt-4 ${selectedAnswer === mriQuiz.questions[currentQuestion].correctAnswer ? 'bg-green-50' : 'bg-red-50'}`}>
-                 {selectedAnswer === mriQuiz.questions[currentQuestion].correctAnswer ? (
+               <Alert className={`mt-4 ${selectedAnswers.length > 0 && isCorrectAnswer(selectedAnswers[0]) ? 'bg-green-50' : 'bg-red-50'}`}>
+                 {selectedAnswers.length > 0 && isCorrectAnswer(selectedAnswers[0]) ? (
                    <CheckCircle2 className="h-4 w-4 text-green-500" />
                  ) : (
                className="mt-6 w-full"
                onClick={showFeedback ? handleContinue : handleNext}
-               disabled={selectedAnswer === null}
+               disabled={selectedAnswers.length === 0}
              >
                {showFeedback 
                  setScore(0);
                  setShowScore(false);
-                 setSelectedAnswer(null);
+                 setSelectedAnswers([]);
                  setShowFeedback(false);
                }}
```

---

我已经完成了以下修改：

1. 将 `selectedAnswer` 状态改为 `selectedAnswers` 数组，以支持多选
2. 更新了 `handleAnswerClick` 函数，支持添加和移除选项
3. 修改了答案判断逻辑，支持单选题和多选题
4. 添加了 `isAnswerSelected` 和 `isCorrectAnswer` 辅助函数来处理答案状态
5. 更新了UI显示逻辑，支持多选状态的显示
6. 修改了按钮的禁用条件，现在需要至少选择一个答案才能继续

现在测验系统可以同时支持单选题和多选题了。对于第一题这样的多选题，用户可以同时选择1.5T和3T作为答案。您需要我做其他调整吗？

---

_**User**_

题面中要注明是单选还是多选；如果是单选，就不要允许用户多选；

---

_**Assistant**_

我来修改代码，在题面中显示题目类型，并根据题目类型限制选择行为。

首先需要修改 `Question` 接口，添加题目类型字段：


---

```diff
    explanation: string;
    category?: string;
+   type: 'single' | 'multiple';
  }
  
        correctAnswer: [0, 1],
        explanation: "1.5T和3T是最常用的临床MRI磁场强度。1.5T提供了良好的图像质量和安全性，而3T虽然分辨率更高，但成本更高且可能产生更多伪影。7T和9.4T主要用于研究目的。",
-       category: "MRI常识"
+       category: "MRI常识",
+       type: "multiple"
      },
      {
        correctAnswer: 1,
        explanation: "MRI利用核磁共振原理，通过外加磁场使人体内的氢原子核产生共振，然后接收共振信号进行成像。这与X射线、超声波等其他成像方式完全不同。",
-       category: "MRI成像原理"
+       category: "MRI成像原理",
+       type: "single"
      },
      // 图像类型
```

---

让我继续修改其他题目的类型：


---

```diff
        correctAnswer: 1,
        explanation: "T1加权图像主要反映组织中的脂肪含量。在T1加权图像中，脂肪组织呈现高信号（亮），而水呈现低信号（暗）。这种对比对于观察解剖结构特别有用。",
-       category: "图像类型"
+       category: "图像类型",
+       type: "single"
      },
      {
        correctAnswer: 2,
        explanation: "T2加权图像对水含量变化非常敏感，因此最适合观察水肿、炎症等病理变化。水肿区域在T2加权图像上呈现高信号。",
-       category: "图像类型"
+       category: "图像类型",
+       type: "single"
      },
      // 造影剂
        correctAnswer: 0,
        explanation: "钆（Gadolinium）是MRI最常用的造影剂。它通过改变局部组织的弛豫时间来增强对比度。碘和钡主要用于CT扫描，而铁基造影剂使用较少。",
-       category: "造影剂"
+       category: "造影剂",
+       type: "single"
      },
      {
        correctAnswer: 1,
        explanation: "钆造影剂通过改变组织的T1弛豫时间来增强对比度。它缩短了周围组织的T1时间，使得这些区域在T1加权图像上呈现高信号。",
-       category: "造影剂"
+       category: "造影剂",
+       type: "single"
      },
      // 安全考虑
        correctAnswer: 1,
        explanation: "MRI检查中最重要的是磁场安全。强磁场可能影响金属植入物，吸引铁磁性物体，因此需要严格的安全筛查和防护措施。",
-       category: "安全考虑"
+       category: "安全考虑",
+       type: "single"
      },
      {
        correctAnswer: 1,
        explanation: "装有心脏起搏器是MRI检查的绝对禁忌症，因为强磁场可能影响起搏器的功能。其他选项可能是相对禁忌症或需要特殊考虑。",
-       category: "安全考虑"
+       category: "安全考虑",
+       type: "single"
      },
      // 临床应用
        correctAnswer: 2,
        explanation: "MRI在中枢神经系统（脑和脊髓）的检查中优势最明显，因为它能提供优异的软组织对比度，且没有电离辐射。",
-       category: "临床应用"
+       category: "临床应用",
+       type: "single"
      },
      {
        correctAnswer: 1,
        explanation: "fMRI主要用于研究脑功能活动，通过检测血氧水平依赖（BOLD）效应来显示大脑不同区域的活动情况。",
-       category: "临床应用"
+       category: "临床应用",
+       type: "single"
      }
    ]
```

---

现在让我修改页面组件，以支持题目类型显示和选择限制：


---

```diff
  
    const handleAnswerClick = (answerIndex: number) => {
+     const currentQuestionData = mriQuiz.questions[currentQuestion];
+     
      setSelectedAnswers(prev => {
+       if (currentQuestionData.type === 'single') {
+         return [answerIndex];
+       } else {
          if (prev.includes(answerIndex)) {
            return prev.filter(index => index !== answerIndex);
          } else {
            return [...prev, answerIndex];
+         }
        }
      });
            </CardHeader>
            <CardContent>
-             <p className="text-xl mb-6">{mriQuiz.questions[currentQuestion].question}</p>
+             <div className="flex justify-between items-center mb-4">
+               <p className="text-xl">{mriQuiz.questions[currentQuestion].question}</p>
+               <span className="text-sm text-gray-500">
+                 {mriQuiz.questions[currentQuestion].type === 'single' ? '单选题' : '多选题'}
+               </span>
+             </div>
              <div className="space-y-4">
                {mriQuiz.questions[currentQuestion].options.map((option, index) => (
```

---

我已经完成了以下修改：

1. 在 `Question` 接口中添加了 `type` 字段，用于标识题目类型（单选/多选）
2. 为所有题目添加了 `type` 属性，第一题设置为多选题，其他题目设置为单选题
3. 修改了 `handleAnswerClick` 函数，根据题目类型限制选择行为：
   - 单选题：只能选择一个选项，选择新选项会替换之前的选项
   - 多选题：可以选择多个选项，可以取消选择
4. 在题目显示区域添加了题目类型标识（"单选题"/"多选题"）

现在用户可以清楚地看到每道题的类型，并且系统会根据题目类型限制选择行为。您需要我做其他调整吗？

---



---

