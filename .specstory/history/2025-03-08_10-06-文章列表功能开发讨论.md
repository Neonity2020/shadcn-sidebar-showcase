## SpecStory

## 文章列表功能开发讨论 (2025/3/8 10:06:21)

_**User**_

文章列表开发
1. 按tag检索文章的功能
2. 分页功能

---

_**Assistant**_

我将帮助您实现文章列表的标签检索和分页功能。让我先查看当前的文章列表页面代码，以便了解现有的实现。

---

_****_

Read file: undefined

---

_****_

现在我需要了解一下文章的MDX文件结构，以便更好地实现标签检索功能。

---

_****_

<details>
            <summary>Listed directory app/(pages)/content/articles • **5** results</summary>
        
| Name |
|-------|
| 📄 `principles-of-DTI.mdx` |
| 📄 `principles-of-DWI.mdx` |
| 📄 `page.tsx` |
| 📄 `von-hippel-lindau-syndrome.mdx` |
| 📁 `[slug]` |

</details>

---

_****_

让我查看一个MDX文件的内容，以了解文章的元数据结构：

---

_****_

Read file: undefined

---

_****_

现在我已经了解了现有的文章列表页面和文章的元数据结构。接下来，我将实现按标签检索和分页功能。

首先，我将修改文章列表页面，添加标签检索和分页功能：

---

_****_

```diff
  import matter from 'gray-matter'
  import { Metadata } from 'next'
+ import { notFound } from 'next/navigation'
  
  export const metadata: Metadata = {
  }
  
- export default function ArticlesPage() {
-   const articles = getArticles()
+ // 获取所有标签
+ function getAllTags(articles) {
+   const tagsSet = new Set()
+   
+   articles.forEach(article => {
+     if (article.tags && Array.isArray(article.tags)) {
+       article.tags.forEach(tag => tagsSet.add(tag))
+     }
+   })
+   
+   return Array.from(tagsSet).sort()
+ }
+ 
+ export default function ArticlesPage({
+   searchParams,
+ }: {
+   searchParams: { tag?: string; page?: string }
+ }) {
+   const allArticles = getArticles()
+   const allTags = getAllTags(allArticles)
+   
+   // 处理标签过滤
+   const selectedTag = searchParams.tag || ''
+   const filteredArticles = selectedTag 
+     ? allArticles.filter(article => 
+         article.tags && article.tags.includes(selectedTag)
+       )
+     : allArticles
+   
+   // 处理分页
+   const currentPage = parseInt(searchParams.page || '1', 10)
+   const articlesPerPage = 9
+   const totalPages = Math.ceil(filteredArticles.length / articlesPerPage)
+   
+   // 验证页码是否有效
+   if (currentPage < 1 || (currentPage > totalPages && totalPages > 0)) {
+     notFound()
+   }
+   
+   // 获取当前页的文章
+   const startIndex = (currentPage - 1) * articlesPerPage
+   const endIndex = startIndex + articlesPerPage
+   const paginatedArticles = filteredArticles.slice(startIndex, endIndex)
+   
+   // 生成分页链接
+   const generatePageLink = (pageNum: number, tag?: string) => {
+     const params = new URLSearchParams()
+     if (pageNum > 1) params.set('page', pageNum.toString())
+     if (tag) params.set('tag', tag)
+     
+     const queryString = params.toString()
+     return queryString ? `?${queryString}` : ''
+   }
    
    return (
      <div className="container mx-auto py-10">
        <h1 className="text-4xl font-bold mb-8">文章列表</h1>
        
+       {/* 标签过滤器 */}
+       <div className="mb-8">
+         <h2 className="text-xl font-semibold mb-4">按标签筛选</h2>
+         <div className="flex flex-wrap gap-2">
+           <Link 
+             href="/content/articles"
+             className={`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${
+               !selectedTag 
+                 ? 'bg-blue-600 text-white' 
+                 : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600'
+             }`}
+           >
+             全部
+           </Link>
+           
+           {allTags.map(tag => (
+             <Link 
+               key={tag} 
+               href={`/content/articles?tag=${encodeURIComponent(tag)}`}
+               className={`px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${
+                 selectedTag === tag 
+                   ? 'bg-blue-600 text-white' 
+                   : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600'
+               }`}
+             >
+               {tag}
+             </Link>
+           ))}
+         </div>
+       </div>
+       
+       {/* 文章列表 */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
-         {articles.map(article => (
+         {paginatedArticles.map(article => (
            <Link 
              key={article.slug} 
        </div>
        
-       {articles.length === 0 && (
+       {filteredArticles.length === 0 && (
          <div className="text-center py-12">
-           <p className="text-xl text-gray-500 dark:text-gray-400">暂无文章</p>
+           <p className="text-xl text-gray-500 dark:text-gray-400">
+             {selectedTag ? `没有找到标签为"${selectedTag}"的文章` : '暂无文章'}
+           </p>
+         </div>
+       )}
+       
+       {/* 分页控件 */}
+       {totalPages > 1 && (
+         <div className="mt-12 flex justify-center">
+           <nav className="flex items-center space-x-2">
+             {/* 上一页按钮 */}
+             <Link
+               href={generatePageLink(currentPage - 1, selectedTag)}
+               className={`px-4 py-2 rounded-md border ${
+                 currentPage === 1
+                   ? 'bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-800 dark:text-gray-500 dark:border-gray-700'
+                   : 'bg-white text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700'
+               }`}
+               aria-disabled={currentPage === 1}
+               tabIndex={currentPage === 1 ? -1 : undefined}
+               onClick={e => currentPage === 1 && e.preventDefault()}
+             >
+               上一页
+             </Link>
+             
+             {/* 页码按钮 */}
+             {Array.from({ length: totalPages }, (_, i) => i + 1).map(page => {
+               // 显示当前页、第一页、最后一页，以及当前页附近的页码
+               if (
+                 page === 1 ||
+                 page === totalPages ||
+                 (page >= currentPage - 1 && page <= currentPage + 1)
+               ) {
+                 return (
+                   <Link
+                     key={page}
+                     href={generatePageLink(page, selectedTag)}
+                     className={`px-4 py-2 rounded-md border ${
+                       currentPage === page
+                         ? 'bg-blue-600 text-white border-blue-600 dark:bg-blue-700 dark:border-blue-700'
+                         : 'bg-white text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700'
+                     }`}
+                     aria-current={currentPage === page ? 'page' : undefined}
+                   >
+                     {page}
+                   </Link>
+                 )
+               }
+               
+               // 显示省略号
+               if (
+                 (page === 2 && currentPage > 3) ||
+                 (page === totalPages - 1 && currentPage < totalPages - 2)
+               ) {
+                 return (
+                   <span
+                     key={page}
+                     className="px-4 py-2 text-gray-500 dark:text-gray-400"
+                   >
+                     ...
+                   </span>
+                 )
+               }
+               
+               return null
+             })}
+             
+             {/* 下一页按钮 */}
+             <Link
+               href={generatePageLink(currentPage + 1, selectedTag)}
+               className={`px-4 py-2 rounded-md border ${
+                 currentPage === totalPages
+                   ? 'bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-800 dark:text-gray-500 dark:border-gray-700'
+                   : 'bg-white text-gray-700 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:bg-gray-700'
+               }`}
+               aria-disabled={currentPage === totalPages}
+               tabIndex={currentPage === totalPages ? -1 : undefined}
+               onClick={e => currentPage === totalPages && e.preventDefault()}
+             >
+               下一页
+             </Link>
+           </nav>
          </div>
        )}
```

---

_****_

我需要修复这些类型错误。让我更新文件：

---

_****_

```diff
  
  // 获取所有标签
- function getAllTags(articles) {
-   const tagsSet = new Set()
+ function getAllTags(articles: any[]): string[] {
+   const tagsSet = new Set<string>()
    
    articles.forEach(article => {
      if (article.tags && Array.isArray(article.tags)) {
-       article.tags.forEach(tag => tagsSet.add(tag))
+       article.tags.forEach((tag: string) => tagsSet.add(tag))
      }
    })
                      {article.tags.slice(0, 3).map((tag: string, index: number) => (
                        <span 
-                         key={index} 
+                         key={`${tag}-${index}`} 
                          className="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded text-xs"
                        >
```

---

_****_

太好了！现在我们已经成功实现了文章列表页面的标签检索和分页功能。让我总结一下我们所做的改进：

## 实现的功能

### 1. 按标签检索文章功能

1. 添加了 `getAllTags` 函数，用于从所有文章中提取唯一的标签列表
2. 实现了标签过滤器 UI，包括：
   - "全部"按钮，用于显示所有文章
   - 动态生成的标签按钮，点击后可以筛选特定标签的文章
   - 当前选中的标签会高亮显示
3. 根据 URL 参数 `tag` 过滤文章列表
4. 当没有找到特定标签的文章时，显示友好的提示信息

### 2. 分页功能

1. 实现了基于 URL 参数 `page` 的分页系统
2. 每页显示固定数量的文章（9篇）
3. 添加了分页控件，包括：
   - 上一页/下一页按钮
   - 页码按钮，显示当前页、第一页、最后一页和当前页附近的页码
   - 当页码过多时，使用省略号（...）表示省略的页码
4. 当前页码按钮高亮显示
5. 无效页码会重定向到 404 页面
6. 分页状态会在标签筛选时保持

### 3. 其他改进

1. 添加了类型注解，修复了 TypeScript 类型错误
2. 优化了 UI 设计，使标签过滤器和分页控件与整体设计风格一致
3. 添加了适当的无障碍属性（aria-*），提高了页面的可访问性

## 使用方法

1. 访问 `/content/articles` 查看所有文章
2. 点击标签按钮筛选特定标签的文章，例如 `/content/articles?tag=MRI`
3. 使用分页控件浏览多页文章，例如 `/content/articles?page=2`
4. 可以同时使用标签筛选和分页，例如 `/content/articles?tag=MRI&page=2`

这些功能使文章列表页面更加用户友好，让用户能够更轻松地找到他们感兴趣的内容。

---



---

