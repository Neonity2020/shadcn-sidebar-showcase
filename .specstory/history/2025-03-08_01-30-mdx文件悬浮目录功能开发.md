<!-- Generated by SpecStory -->

# MDX文件悬浮目录功能开发 (2025-03-08 09:30:40)

_**User**_

重新构建对mdx文件的支持，mdx开发悬浮目录的功能，可以通过点击TOC节点跳转定位到对应标题章节

---

_**Assistant**_

我需要为您构建一个支持MDX文件的组件，并添加悬浮目录(TOC)功能，使用户可以通过点击目录项跳转到对应的标题章节。首先，我需要了解当前项目的结构和相关文件。

---

<details>
            <summary>Listed current directory • **25** results</summary>
        
| Name |
|-------|
| 📁 `.next` |
| 📄 `.env` |
| 📄 `middleware.ts` |
| 📁 `prisma` |
| 📄 `next-env.d.ts` |
| 📁 `node_modules` |
| 📄 `package-lock.json` |
| 📁 `.git` |
| 📁 `scripts` |
| 📁 `styles` |
| 📄 `tailwind.config.ts` |
| 📄 `tsconfig.json` |
| 📁 `types` |
| 📁 `public` |
| 📄 `package.json` |
| 📄 `postcss.config.mjs` |
| 📁 `data` |
| 📁 `hooks` |
| 📁 `lib` |
| 📄 `next.config.mjs` |
| 📁 `components` |
| 📁 `app` |
| 📄 `components.json` |
| 📄 `.gitignore` |
| 📁 `.specstory` |

</details>

---

让我查看一下 components 目录中的内容，特别是与 MDX 相关的组件：

---

<details>
            <summary>Listed directory components • **16** results</summary>
        
| Name |
|-------|
| 📄 `mdx-component.tsx` |
| 📁 `ui` |
| 📄 `blog-post.tsx` |
| 📄 `book-card.tsx` |
| 📄 `breadcrumb-nav.tsx` |
| 📄 `file-list.tsx` |
| 📄 `image.tsx` |
| 📄 `nav-main.tsx` |
| 📄 `nav-projects.tsx` |
| 📄 `nav-user.tsx` |
| 📄 `providers.tsx` |
| 📄 `team-switcher.tsx` |
| 📄 `theme-provider.tsx` |
| 📄 `app-sidebar.tsx` |
| 📄 `blog-card.tsx` |
| 📄 `blog-list.tsx` |

</details>

---

我看到 `mdx-component.tsx` 文件是空的。让我查看一下 app 目录，特别是与文章内容相关的部分：

---

<details>
            <summary>Listed directory app/(pages)/content • **6** results</summary>
        
| Name |
|-------|
| 📄 `layout.tsx` |
| 📁 `mdx-example` |
| 📄 `mdx-example.mdx` |
| 📄 `page.tsx` |
| 📁 `articles` |
| 📁 `blog` |

</details>

---

让我查看一下 articles 目录：

---

<details>
            <summary>Listed directory app/(pages)/content/articles • **4** results</summary>
        
| Name |
|-------|
| 📄 `page.tsx` |
| 📄 `principles-of-DWI.mdx` |
| 📄 `von-hippel-lindau-syndrome.mdx` |
| 📁 `[slug]` |

</details>

---

让我查看一下 [slug] 目录，这可能是用于动态路由的：

---

<details>
            <summary>Listed directory app/(pages)/content/articles/[slug] • **1** results</summary>
        
| Name |
|-------|
| 📄 `page.tsx` |

</details>

---

现在让我查看一下 package.json 文件，了解项目中已安装的 MDX 相关依赖：

---

Read file: package.json

---

让我查看一下 [slug] 页面的实现，了解当前的 MDX 渲染方式：

---

Read file: app/(pages)/content/articles/[slug]/page.tsx

---

让我查看一下 MDX 组件的引用：

---

<details>
            <summary>Grep search for "MDXComponents" • **13** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-04_21-05-convert-article-to-mdx-format.md` | L218 | `+ import { useMDXComponents } from "@/components/mdx-component"` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-04_21-05-convert-article-to-mdx-format.md` | L397 | `+         components={useMDXComponents({})}` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-04_21-05-convert-article-to-mdx-format.md` | L417 | `- import { useMDXComponents } from "@/components/mdx-component"` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-04_21-05-convert-article-to-mdx-format.md` | L418 | `+ import { useMDXComponents } from "@/components/mdx-components"` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-04_21-05-convert-article-to-mdx-format.md` | L458 | `- import { useMDXComponents } from "@/components/mdx-components"` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-04_21-05-convert-article-to-mdx-format.md` | L459 | `+ import { useMDXComponents } from "@/mdx-component"` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-06_07-52-%E7%94%9F%E6%88%90%E5%BF%85%E8%A6%81%E7%9A%84meta%E4%BF%A1%E6%81%AF.md` | L514 | `+ import { MDXComponents } from '@/mdx-component'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-06_07-52-%E7%94%9F%E6%88%90%E5%BF%85%E8%A6%81%E7%9A%84meta%E4%BF%A1%E6%81%AF.md` | L554 | `+             ...MDXComponents` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_12-14-%E4%B8%BAmdx%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E7%9B%AE%E5%BD%95%E5%8A%9F%E8%83%BD.md` | L63 | `...MDXComponents,` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_12-14-%E4%B8%BAmdx%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E7%9B%AE%E5%BD%95%E5%8A%9F%E8%83%BD.md` | L135 | `为了让目录链接正常工作，我们需要确保MDX内容中的标题有对应的ID。我们可以通过修改MDXComponents来实现这一点。` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_12-14-%E4%B8%BAmdx%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E7%9B%AE%E5%BD%95%E5%8A%9F%E8%83%BD.md` | L137 | `创建或修改你的MDXComponents文件：` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_12-14-%E4%B8%BAmdx%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E7%9B%AE%E5%BD%95%E5%8A%9F%E8%83%BD.md` | L140 | `// 添加这个函数到你的MDXComponents文件中` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_12-14-%E4%B8%BAmdx%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E7%9B%AE%E5%BD%95%E5%8A%9F%E8%83%BD.md` | L141 | `export const MDXComponents = {` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-06_08-17-%E8%A1%80%E7%AE%A1%E6%AF%8D%E7%BB%86%E8%83%9E%E7%98%A4%E8%AF%8D%E6%9D%A1%E9%93%BE%E6%8E%A5.md` | L1057 | `MDXComponents: MDXComponents,` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-06_08-17-%E8%A1%80%E7%AE%A1%E6%AF%8D%E7%BB%86%E8%83%9E%E7%98%A4%E8%AF%8D%E6%9D%A1%E9%93%BE%E6%8E%A5.md` | L1332 | `-             ...MDXComponents` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-06_08-17-%E8%A1%80%E7%AE%A1%E6%AF%8D%E7%BB%86%E8%83%9E%E7%98%A4%E8%AF%8D%E6%9D%A1%E9%93%BE%E6%8E%A5.md` | L1333 | `+             ...MDXComponents,` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-15-untitled.md` | L225 | `+   MDXComponents: () => (` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-15-untitled.md` | L233 | `+ export function useMDXComponents() {` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-15-untitled.md` | L253 | `- import { MDXComponents } from '@/mdx-component'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-15-untitled.md` | L254 | `+ import { MDXComponents } from '@/app/mdx-components'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L259 | `import type { MDXComponents } from 'mdx/types'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L352 | `+   MDXComponents: () => (` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L360 | `export function useMDXComponents(components: MDXComponents): MDXComponents {` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L547 | `+ import { MDXComponents } from '@/mdx-component'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L563 | `+           <MDXComponents />` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L583 | `让我们修复 MDXComponents 的导入问题：` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L590 | `- import type { MDXComponents } from 'mdx/types'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L591 | `+ import type { MDXComponents as MDXComponentsType } from 'mdx/types'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L597 | `+ export const MDXComponents = () => (` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L607 | `-   MDXComponents: () => (` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L615 | `- export function useMDXComponents(components: MDXComponents): MDXComponents {` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L616 | `+ export function useMDXComponents(components: MDXComponentsType): MDXComponentsType {` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L954 | `Error: Expected component `MDXComponents` to be defined: you likely forgot to import, pass, or provide it.` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L965 | `我看到了错误信息，这是因为在渲染 MDX 文件时找不到 `MDXComponents` 组件。让我们解决这个问题。` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L976 | `+ import { MDXComponents } from '@/mdx-component'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L985 | `+             MDXComponents` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L998 | `现在，我们还需要修改 `mdx-component.tsx` 文件，确保我们正确地导出所有组件，并且 `useMDXComponents` 函数能够正确地合并自定义组件：` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L1008 | `+ const mdxComponents = {` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L1013 | `+   MDXComponents: MDXComponents,` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L1016 | `export function useMDXComponents(components: MDXComponentsType): MDXComponentsType {` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-02_15-20-%E6%AD%A3%E7%A1%AE%E6%B8%B2%E6%9F%93mdx%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%A8%E8%AE%BA.md` | L1020 | `+     ...mdxComponents,` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_13-09-dwi%E6%88%90%E5%83%8F%E5%8E%9F%E7%90%86%E4%B8%8E%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE.md` | L870 | `export const MDXComponents = () => (` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_15-09-%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%97%AE%E9%A2%98%E6%A3%80%E6%9F%A5.md` | L64 | `<summary>Searched codebase "MDXComponents implementation" • **25** results</summary>` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_15-09-%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%97%AE%E9%A2%98%E6%A3%80%E6%9F%A5.md` | L103 | `- 在 `mdx-component.tsx` 中，`MDXComponents` 的导出和使用方式有些混乱` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_15-09-%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%97%AE%E9%A2%98%E6%A3%80%E6%9F%A5.md` | L127 | `export const MDXComponents = () => (` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_15-09-%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%97%AE%E9%A2%98%E6%A3%80%E6%9F%A5.md` | L130 | `const mdxComponents = {` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_15-09-%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%97%AE%E9%A2%98%E6%A3%80%E6%9F%A5.md` | L168 | `-   MDXComponents: MDXComponents,` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/.specstory/history/2025-03-07_15-09-%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81%E9%97%AE%E9%A2%98%E6%A3%80%E6%9F%A5.md` | L170 | `+   MDXComponents,` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/app/%28pages%29/content/page.tsx` | Lundefined | `import { MDXComponents } from '@/components/mdx-component'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/app/%28pages%29/content/page.tsx` | L11 | `<MDXComponents />` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/app/%28pages%29/content/mdx-example.mdx` | L12 | `<MDXComponents />` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/app/%28pages%29/content/articles/%5Bslug%5D/page.tsx` | L4 | `import { MDXComponents } from '@/components/mdx-component'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/app/%28pages%29/content/articles/%5Bslug%5D/page.tsx` | L165 | `...MDXComponents,` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/app/%28pages%29/content/blog/nextjs-tailwind-blog/page.tsx` | L1 | `import { useMDXComponents } from "@/components/mdx-component"` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/app/%28pages%29/content/blog/nextjs-tailwind-blog/page.tsx` | L26 | `components={useMDXComponents({})}` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/app/%28pages%29/content/mdx-example/page.tsx` | L3 | `import { MDXComponents } from '@/components/mdx-component'` |
| `file:///Users/andi/Documents/GitHub/my-mri-lib/app/%28pages%29/content/mdx-example/page.tsx` | L15 | `MDXComponents` |

</details>

---

现在我了解了项目的结构和当前的 MDX 实现。让我查看一下 next.config.mjs 文件，了解 MDX 的配置：

---

Read file: next.config.mjs

---

现在，我将创建一个完整的 MDX 组件，包括悬浮目录功能，并确保可以通过点击目录项跳转到对应的标题章节。

---

```diff
- 
+ import React, { useEffect, useState, useRef } from 'react'
+ import Link from 'next/link'
+ import Image from 'next/image'
+ import { useMDXComponent } from 'next-mdx-remote/rsc'
+ import type { MDXComponents as MDXComponentsType } from 'mdx/types'
+ 
+ // 生成一致的ID
+ function generateId(text: string): string {
+   return text
+     .toLowerCase()
+     .replace(/\s+/g, '-')
+     .replace(/[^\w\-]+/g, '')
+     .replace(/[\(\)]/g, ''); // 移除括号
+ }
+ 
+ // 定义标题项的接口
+ interface Heading {
+   level: number;
+   text: string;
+   id: string;
+ }
+ 
+ // 目录组件
+ const TableOfContents = ({ headings }: { headings: Heading[] }) => {
+   const [activeId, setActiveId] = useState<string>('');
+   const observerRef = useRef<IntersectionObserver | null>(null);
+   const headingRefs = useRef<Map<string, HTMLElement>>(new Map());
+ 
+   useEffect(() => {
+     // 初始化 IntersectionObserver
+     const callback = (entries: IntersectionObserverEntry[]) => {
+       // 找到当前可见的标题
+       const visibleHeadings = entries.filter(entry => entry.isIntersecting);
+       
+       if (visibleHeadings.length > 0) {
+         // 如果有多个可见标题，选择第一个
+         const visibleId = visibleHeadings[0].target.id;
+         setActiveId(visibleId);
+       }
+     };
+ 
+     observerRef.current = new IntersectionObserver(callback, {
+       rootMargin: '-80px 0px -40% 0px', // 调整观察区域
+       threshold: 0.1 // 当标题元素10%可见时触发
+     });
+ 
+     // 观察所有标题元素
+     document.querySelectorAll('h2, h3, h4').forEach(heading => {
+       if (heading.id) {
+         headingRefs.current.set(heading.id, heading as HTMLElement);
+         observerRef.current?.observe(heading);
+       }
+     });
+ 
+     return () => {
+       // 清理观察器
+       if (observerRef.current) {
+         observerRef.current.disconnect();
+       }
+     };
+   }, []);
+ 
+   // 处理点击目录项
+   const handleClick = (e: React.MouseEvent<HTMLAnchorElement>, id: string) => {
+     e.preventDefault();
+     const element = document.getElementById(id);
+     if (element) {
+       // 平滑滚动到目标元素
+       window.scrollTo({
+         top: element.offsetTop - 80, // 考虑固定导航栏的高度
+         behavior: 'smooth'
+       });
+       
+       // 更新活动ID
+       setActiveId(id);
+     }
+   };
+ 
+   if (headings.length === 0) return null;
+ 
+   return (
+     <nav className="toc text-sm">
+       <ul className="space-y-2">
+         {headings.map((heading, index) => (
+           <li 
+             key={index} 
+             className={`
+               ${heading.level === 2 ? 'font-medium' : 'text-gray-600 dark:text-gray-400'} 
+               ${heading.level > 2 ? `ml-${(heading.level - 2) * 3}` : ''}
+               transition-colors
+             `}
+           >
+             <a 
+               href={`#${heading.id}`} 
+               onClick={(e) => handleClick(e, heading.id)}
+               className={`
+                 block py-1 border-l-2 pl-2 toc-item
+                 ${activeId === heading.id 
+                   ? 'border-blue-500 text-blue-600 dark:text-blue-400 font-medium' 
+                   : 'border-transparent hover:border-blue-300 hover:text-blue-500 dark:hover:text-blue-300'}
+               `}
+             >
+               {heading.text}
+             </a>
+           </li>
+         ))}
+       </ul>
+     </nav>
+   );
+ };
+ 
+ // 提取标题的函数
+ const extractHeadings = (children: React.ReactNode): Heading[] => {
+   const headings: Heading[] = [];
+   
+   React.Children.forEach(children, (child) => {
+     if (React.isValidElement(child)) {
+       // 检查是否是标题元素
+       if (child.type === 'h2' || child.type === 'h3' || child.type === 'h4') {
+         const level = parseInt(child.type.charAt(1), 10);
+         const text = React.Children.toArray(child.props.children)
+           .filter((child) => typeof child === 'string')
+           .join('');
+         
+         const id = child.props.id || generateId(text);
+         
+         headings.push({ level, text, id });
+       }
+       
+       // 递归检查子元素
+       if (child.props && child.props.children) {
+         const nestedHeadings = extractHeadings(child.props.children);
+         headings.push(...nestedHeadings);
+       }
+     }
+   });
+   
+   return headings;
+ };
+ 
+ // MDX内容包装器组件
+ const MDXContentWrapper = ({ children }: { children: React.ReactNode }) => {
+   const [headings, setHeadings] = useState<Heading[]>([]);
+   const contentRef = useRef<HTMLDivElement>(null);
+   
+   useEffect(() => {
+     if (contentRef.current) {
+       // 从DOM中提取标题
+       const headingElements = contentRef.current.querySelectorAll('h2, h3, h4');
+       const extractedHeadings: Heading[] = [];
+       
+       headingElements.forEach((element) => {
+         const level = parseInt(element.tagName.charAt(1), 10);
+         const text = element.textContent || '';
+         const id = element.id || generateId(text);
+         
+         // 确保标题元素有ID
+         if (!element.id) {
+           element.id = id;
+         }
+         
+         extractedHeadings.push({ level, text, id });
+       });
+       
+       setHeadings(extractedHeadings);
+     }
+   }, [children]);
+   
+   return (
+     <div className="relative flex flex-col lg:flex-row gap-8">
+       {/* 主要内容区域 */}
+       <div className="prose dark:prose-invert max-w-none lg:w-3/4" ref={contentRef}>
+         {children}
+       </div>
+       
+       {/* 右侧悬浮目录 */}
+       {headings.length > 0 && (
+         <div className="lg:w-1/4">
+           <div className="sticky top-24 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-sm">
+             <h2 className="text-xl font-bold mb-4">目录</h2>
+             <TableOfContents headings={headings} />
+           </div>
+         </div>
+       )}
+     </div>
+   );
+ };
+ 
+ // 自定义MDX组件
+ export const MDXComponents: MDXComponentsType = {
+   h1: ({ children }) => <h1 id={generateId(children as string)}>{children}</h1>,
+   h2: ({ children }) => <h2 id={generateId(children as string)}>{children}</h2>,
+   h3: ({ children }) => <h3 id={generateId(children as string)}>{children}</h3>,
+   h4: ({ children }) => <h4 id={generateId(children as string)}>{children}</h4>,
+   a: ({ href, children }) => <Link href={href as string}>{children}</Link>,
+   img: ({ src, alt }) => (
+     <div className="my-6">
+       <Image 
+         src={src as string} 
+         alt={alt as string} 
+         width={800} 
+         height={500} 
+         className="rounded-lg"
+       />
+     </div>
+   ),
+   pre: ({ children }) => (
+     <pre className="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-x-auto">
+       {children}
+     </pre>
+   ),
+   code: ({ children }) => (
+     <code className="bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-sm">
+       {children}
+     </code>
+   ),
+   table: ({ children }) => (
+     <div className="overflow-x-auto">
+       <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
+         {children}
+       </table>
+     </div>
+   ),
+   blockquote: ({ children }) => (
+     <blockquote className="border-l-4 border-blue-500 pl-4 italic">
+       {children}
+     </blockquote>
+   ),
+   wrapper: ({ children }) => <MDXContentWrapper>{children}</MDXContentWrapper>,
+ };
+ 
+ // 用于合并自定义组件的函数
+ export function useMDXComponents(components: MDXComponentsType): MDXComponentsType {
+   return {
+     ...MDXComponents,
+     ...components,
+   };
+ }
+ 
+ export default MDXComponents;
+ 
```

---

我需要修复一些类型错误。让我更新 MDX 组件文件：

---

```diff
  import Link from 'next/link'
  import Image from 'next/image'
- import { useMDXComponent } from 'next-mdx-remote/rsc'
+ import { MDXRemote } from 'next-mdx-remote/rsc'
  import type { MDXComponents as MDXComponentsType } from 'mdx/types'
  
      if (React.isValidElement(child)) {
        // 检查是否是标题元素
-       if (child.type === 'h2' || child.type === 'h3' || child.type === 'h4') {
-         const level = parseInt(child.type.charAt(1), 10);
+       const childType = child.type as React.ElementType;
+       if (childType === 'h2' || childType === 'h3' || childType === 'h4') {
+         const level = parseInt(childType.charAt(1), 10);
          const text = React.Children.toArray(child.props.children)
            .filter((child) => typeof child === 'string')
  // 自定义MDX组件
  export const MDXComponents: MDXComponentsType = {
-   h1: ({ children }) => <h1 id={generateId(children as string)}>{children}</h1>,
-   h2: ({ children }) => <h2 id={generateId(children as string)}>{children}</h2>,
-   h3: ({ children }) => <h3 id={generateId(children as string)}>{children}</h3>,
-   h4: ({ children }) => <h4 id={generateId(children as string)}>{children}</h4>,
-   a: ({ href, children }) => <Link href={href as string}>{children}</Link>,
-   img: ({ src, alt }) => (
+   h1: (props: any) => <h1 id={generateId(props.children as string)} {...props} />,
+   h2: (props: any) => <h2 id={generateId(props.children as string)} {...props} />,
+   h3: (props: any) => <h3 id={generateId(props.children as string)} {...props} />,
+   h4: (props: any) => <h4 id={generateId(props.children as string)} {...props} />,
+   a: (props: any) => <Link href={props.href as string} {...props} />,
+   img: (props: any) => (
      <div className="my-6">
        <Image 
-         src={src as string} 
-         alt={alt as string} 
+         src={props.src as string} 
+         alt={props.alt as string || ''} 
          width={800} 
          height={500} 
      </div>
    ),
-   pre: ({ children }) => (
-     <pre className="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-x-auto">
-       {children}
-     </pre>
+   pre: (props: any) => (
+     <pre className="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-x-auto" {...props} />
    ),
-   code: ({ children }) => (
-     <code className="bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-sm">
-       {children}
-     </code>
+   code: (props: any) => (
+     <code className="bg-gray-100 dark:bg-gray-800 px-1 py-0.5 rounded text-sm" {...props} />
    ),
-   table: ({ children }) => (
+   table: (props: any) => (
      <div className="overflow-x-auto">
-       <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
-         {children}
-       </table>
+       <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700" {...props} />
      </div>
    ),
-   blockquote: ({ children }) => (
-     <blockquote className="border-l-4 border-blue-500 pl-4 italic">
-       {children}
-     </blockquote>
+   blockquote: (props: any) => (
+     <blockquote className="border-l-4 border-blue-500 pl-4 italic" {...props} />
    ),
-   wrapper: ({ children }) => <MDXContentWrapper>{children}</MDXContentWrapper>,
+   wrapper: (props: any) => <MDXContentWrapper>{props.children}</MDXContentWrapper>,
  };
  
```

---

我需要再次修复一些类型问题。让我更新文件：

---

```diff
  };
  
- // 提取标题的函数
- const extractHeadings = (children: React.ReactNode): Heading[] => {
+ // 简化版的提取标题函数，避免类型问题
+ function extractHeadings(content: string): Heading[] {
+   const headingRegex = /^(#{2,4})\s+(.+)$/gm;
    const headings: Heading[] = [];
-   
-   React.Children.forEach(children, (child) => {
-     if (React.isValidElement(child)) {
-       // 检查是否是标题元素
-       const childType = child.type as React.ElementType;
-       if (childType === 'h2' || childType === 'h3' || childType === 'h4') {
-         const level = parseInt(childType.charAt(1), 10);
-         const text = React.Children.toArray(child.props.children)
-           .filter((child) => typeof child === 'string')
-           .join('');
-         
-         const id = child.props.id || generateId(text);
+   let match;
+ 
+   while ((match = headingRegex.exec(content)) !== null) {
+     const level = match[1].length; // 获取#的数量，表示标题级别
+     const text = match[2].trim();
+     const id = generateId(text);
  
      headings.push({ level, text, id });
    }
-       
-       // 递归检查子元素
-       if (child.props && child.props.children) {
-         const nestedHeadings = extractHeadings(child.props.children);
-         headings.push(...nestedHeadings);
-       }
-     }
-   });
  
    return headings;
- };
+ }
  
  // MDX内容包装器组件
  // 自定义MDX组件
  export const MDXComponents: MDXComponentsType = {
-   h1: (props: any) => <h1 id={generateId(props.children as string)} {...props} />,
-   h2: (props: any) => <h2 id={generateId(props.children as string)} {...props} />,
-   h3: (props: any) => <h3 id={generateId(props.children as string)} {...props} />,
-   h4: (props: any) => <h4 id={generateId(props.children as string)} {...props} />,
-   a: (props: any) => <Link href={props.href as string} {...props} />,
+   h1: (props: any) => <h1 id={generateId(String(props.children))} {...props} />,
+   h2: (props: any) => <h2 id={generateId(String(props.children))} {...props} />,
+   h3: (props: any) => <h3 id={generateId(String(props.children))} {...props} />,
+   h4: (props: any) => <h4 id={generateId(String(props.children))} {...props} />,
+   a: (props: any) => <Link href={props.href || '#'} {...props} />,
    img: (props: any) => (
      <div className="my-6">
        <Image 
-         src={props.src as string} 
-         alt={props.alt as string || ''} 
+         src={props.src || ''} 
+         alt={props.alt || ''} 
          width={800} 
          height={500} 
```

---

现在，我需要更新 [slug] 页面，以使用我们新创建的 MDX 组件和悬浮目录功能：

---

```diff
    return (
      <div className="container mx-auto py-10">
-       <div className="relative flex flex-col lg:flex-row gap-8">
-         {/* 主要内容区域 */}
-         <div className="prose dark:prose-invert max-w-none lg:w-3/4">
-           <h1 className="text-4xl font-bold mb-4">{data.title}</h1>
-           <div className="flex items-center text-sm text-gray-500 mb-8">
-             {data.date && <span className="mr-4">发布日期: {data.date}</span>}
-             {data.author && <span className="mr-4">作者: {data.author}</span>}
-             {data.category && (
-               <span className="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-100 rounded-full">
-                 {data.category}
-               </span>
-             )}
-           </div>
-           
-           <MDXRemote 
-             source={content} 
-             components={{
-               ...MDXComponents,
-               Image
-             }}
-             options={{
-               parseFrontmatter: true,
-             }}
-           />
-           {data.tags && data.tags.length > 0 && (
-             <div className="mt-8 pt-4 border-t">
-               <h3 className="text-lg font-semibold mb-2">标签:</h3>
-               <div className="flex flex-wrap gap-2">
-                 {data.tags.map((tag: string) => (
-                   <span 
-                     key={tag} 
-                     className="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-full text-sm"
-                   >
-                     {tag}
-                   </span>
-                 ))}
-               </div>
-             </div>
-           )}
-         </div>
-         
-         {/* 右侧悬浮目录 */}
-         {processedHeadings.length > 0 && (
-           <div className="lg:w-1/4">
-             <div className="sticky top-24 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-sm mt-16 lg:mt-24">
-               <h2 className="text-xl font-bold mb-4">目录</h2>
-               <TableOfContents headings={processedHeadings} />
-             </div>
-           </div>
-         )}
-       </div>
- 
-       {/* 添加平滑滚动和锚点高亮的客户端脚本 */}
-       <script
-         dangerouslySetInnerHTML={{
-           __html: `
-             // 确保在DOM完全加载后执行
-             if (document.readyState === 'loading') {
-               document.addEventListener('DOMContentLoaded', initTOC);
-             } else {
-               initTOC();
-             }
- 
-             function initTOC() {
-               // 延迟执行以确保React组件已完全渲染
-               setTimeout(() => {
-                 // 为所有标题添加可见的锚点链接
-                 document.querySelectorAll('.prose h2, .prose h3, .prose h4').forEach(heading => {
-                   // 检查标题是否已有ID，如果没有则添加
-                   if (!heading.id) {
-                     const text = heading.textContent || '';
-                     const id = text
-                       .toLowerCase()
-                       .replace(/\\s+/g, '-')
-                       .replace(/[^\\w\\-]+/g, '')
-                       .replace(/[\\(\\)]/g, ''); // 移除括号
-                     heading.id = id;
-                   }
-                 });
-                 
-                 // 平滑滚动到锚点
-                 document.querySelectorAll('.toc-item').forEach(link => {
-                   link.addEventListener('click', (e) => {
-                     e.preventDefault();
-                     const href = link.getAttribute('href');
-                     if (!href) return;
-                     
-                     const targetId = href.substring(1);
-                     const targetElement = document.getElementById(targetId);
-                     
-                     if (targetElement) {
-                       // 移除所有高亮
-                       document.querySelectorAll('.toc-item').forEach(item => {
-                         item.classList.remove('active', 'border-blue-500', 'text-blue-600', 'font-medium');
-                       });
-                       
-                       // 添加高亮到当前项
-                       link.classList.add('active', 'border-blue-500', 'text-blue-600', 'font-medium');
-                       
-                       // 获取目标元素的位置
-                       const rect = targetElement.getBoundingClientRect();
-                       const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
-                       const targetTop = rect.top + scrollTop;
-                       
-                       // 平滑滚动到目标位置
-                       window.scrollTo({
-                         top: targetTop - 80, // 添加一些偏移以避免标题被固定导航栏遮挡
-                         behavior: 'smooth'
-                       });
-                       
-                       // 更新URL
-                       history.pushState(null, '', href);
-                     }
-                   });
-                 });
-                 
-                 // 滚动监听以高亮当前可见的标题
-                 const observerOptions = {
-                   root: null,
-                   rootMargin: '-80px 0px -70% 0px', // 调整可见区域，使标题进入视口上部时触发
-                   threshold: 0
-                 };
-                 
-                 const headingObserver = new IntersectionObserver((entries) => {
-                   entries.forEach(entry => {
-                     if (entry.isIntersecting) {
-                       const id = entry.target.id;
-                       
-                       // 移除所有高亮
-                       document.querySelectorAll('.toc-item').forEach(item => {
-                         item.classList.remove('active', 'border-blue-500', 'text-blue-600', 'font-medium');
-                       });
-                       
-                       // 添加高亮到当前项
-                       const currentItem = document.querySelector(\`.toc-item[href="#\${id}"]\`);
-                       if (currentItem) {
-                         currentItem.classList.add('active', 'border-blue-500', 'text-blue-600', 'font-medium');
-                       }
-                     }
-                   });
-                 }, observerOptions);
-                 
-                 // 监听所有标题元素
-                 document.querySelectorAll('.prose h2, .prose h3, .prose h4').forEach(heading => {
-                   headingObserver.observe(heading);
-                 });
-                 
-                 // 初始检查URL中是否有锚点，如果有则滚动到对应位置
-                 if (window.location.hash) {
-                   const targetId = window.location.hash.substring(1);
-                   const targetElement = document.getElementById(targetId);
-                   
-                   if (targetElement) {
-                     setTimeout(() => {
-                       const rect = targetElement.getBoundingClientRect();
-                       const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
-                       const targetTop = rect.top + scrollTop;
-                       
-                       window.scrollTo({
-                         top: targetTop - 80,
-                         behavior: 'smooth'
-                       });
-                       
-                       // 高亮对应的目录项
-                       const tocItem = document.querySelector(\`.toc-item[href="#\${targetId}"]\`);
-                       if (tocItem) {
-                         tocItem.classList.add('active', 'border-blue-500', 'text-blue-600', 'font-medium');
-                       }
-                     }, 500); // 延迟更长时间以确保页面已完全加载
-                   }
-                 }
-               }, 500);
-             }
-           `
-         }}
-       />
+       <div className="mb-8">
+         <h1 className="text-4xl font-bold mb-4">{data.title}</h1>
+         <div className="flex items-center text-sm text-gray-500">
+           {data.date && <span className="mr-4">发布日期: {data.date}</span>}
+           {data.author && <span className="mr-4">作者: {data.author}</span>}
+           {data.category && (
+             <span className="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-100 rounded-full">
+               {data.category}
+             </span>
+           )}
+         </div>
+       </div>
+       
+       <MDXRemote 
+         source={content} 
+         components={{
+           ...MDXComponents,
+           Image
+         }}
+         options={{
+           parseFrontmatter: true,
+         }}
+       />
+       
+       {data.tags && data.tags.length > 0 && (
+         <div className="mt-8 pt-4 border-t">
+           <h3 className="text-lg font-semibold mb-2">标签:</h3>
+           <div className="flex flex-wrap gap-2">
+             {data.tags.map((tag: string) => (
+               <span 
+                 key={tag} 
+                 className="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-full text-sm"
+               >
+                 {tag}
+               </span>
+             ))}
+           </div>
+         </div>
+       )}
      </div>
    )
```

---

现在，我需要更新 articles 页面，以便它能够正确显示文章列表：

---

```diff
- 
+ import fs from 'fs'
+ import path from 'path'
+ import Link from 'next/link'
+ import matter from 'gray-matter'
+ import { Metadata } from 'next'
+ 
+ export const metadata: Metadata = {
+   title: '文章列表',
+   description: '浏览所有可用的医学影像学文章',
+ }
+ 
+ // 获取文章元数据
+ function getArticles() {
+   const articlesDirectory = path.join(process.cwd(), 'app/(pages)/content/articles')
+   const filenames = fs.readdirSync(articlesDirectory)
+   
+   const articles = filenames
+     .filter(filename => filename.endsWith('.mdx'))
+     .map(filename => {
+       const filePath = path.join(articlesDirectory, filename)
+       const fileContent = fs.readFileSync(filePath, 'utf8')
+       const { data } = matter(fileContent)
+       
+       return {
+         slug: filename.replace(/\.mdx$/, ''),
+         title: data.title || '无标题',
+         description: data.description || '',
+         date: data.date || '',
+         author: data.author || '',
+         category: data.category || '',
+         tags: data.tags || [],
+       }
+     })
+     .sort((a, b) => {
+       if (a.date && b.date) {
+         return new Date(b.date).getTime() - new Date(a.date).getTime()
+       }
+       return 0
+     })
+   
+   return articles
+ }
+ 
+ export default function ArticlesPage() {
+   const articles = getArticles()
+   
+   return (
+     <div className="container mx-auto py-10">
+       <h1 className="text-4xl font-bold mb-8">文章列表</h1>
+       
+       <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
+         {articles.map(article => (
+           <Link 
+             key={article.slug} 
+             href={`/content/articles/${article.slug}`}
+             className="block group"
+           >
+             <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300">
+               <div className="p-6">
+                 <div className="flex items-center mb-4">
+                   {article.category && (
+                     <span className="px-3 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-100 text-xs rounded-full">
+                       {article.category}
+                     </span>
+                   )}
+                   {article.date && (
+                     <span className="text-gray-500 dark:text-gray-400 text-sm ml-auto">
+                       {article.date}
+                     </span>
+                   )}
+                 </div>
+                 
+                 <h2 className="text-xl font-bold mb-2 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
+                   {article.title}
+                 </h2>
+                 
+                 {article.description && (
+                   <p className="text-gray-600 dark:text-gray-300 mb-4 line-clamp-3">
+                     {article.description}
+                   </p>
+                 )}
+                 
+                 <div className="flex items-center mt-4">
+                   {article.author && (
+                     <span className="text-sm text-gray-500 dark:text-gray-400">
+                       作者: {article.author}
+                     </span>
+                   )}
+                   
+                   <span className="ml-auto text-blue-600 dark:text-blue-400 font-medium group-hover:underline">
+                     阅读更多
+                   </span>
+                 </div>
+               </div>
+               
+               {article.tags && article.tags.length > 0 && (
+                 <div className="px-6 pb-4">
+                   <div className="flex flex-wrap gap-2">
+                     {article.tags.slice(0, 3).map((tag, index) => (
+                       <span 
+                         key={index} 
+                         className="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded text-xs"
+                       >
+                         {tag}
+                       </span>
+                     ))}
+                     {article.tags.length > 3 && (
+                       <span className="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded text-xs">
+                         +{article.tags.length - 3}
+                       </span>
+                     )}
+                   </div>
+                 </div>
+               )}
+             </div>
+           </Link>
+         ))}
+       </div>
+       
+       {articles.length === 0 && (
+         <div className="text-center py-12">
+           <p className="text-xl text-gray-500 dark:text-gray-400">暂无文章</p>
+         </div>
+       )}
+     </div>
+   )
+ }
+ 
```

---

让我修复文章列表页面中的类型错误：

---

```diff
                  <div className="px-6 pb-4">
                    <div className="flex flex-wrap gap-2">
-                     {article.tags.slice(0, 3).map((tag, index) => (
+                     {article.tags.slice(0, 3).map((tag: string, index: number) => (
                        <span 
                          key={index} 
```

---

现在让我们测试一下我们的实现：

---

Cancelled

---



---

_**User**_

fix

---

_**Assistant**_

我看到错误了，需要在 MDX 组件中添加 "use client" 指令，因为我们使用了客户端 React hooks（useEffect、useState 和 useRef）。让我修复这个问题：

---

```diff
+ "use client"
+ 
  import React, { useEffect, useState, useRef } from 'react'
  import Link from 'next/link'
```

---

现在让我们再次运行开发服务器来测试我们的修复：

---

Cancelled

---



---

_**User**_

文章多级标题没有正常显示

---

_**Assistant**_

我需要修复文章中多级标题显示的问题。问题可能出在 MDX 组件的实现上，特别是在标题的渲染和目录生成部分。让我检查并修复这个问题：

---

```diff
              className={`
                ${heading.level === 2 ? 'font-medium' : 'text-gray-600 dark:text-gray-400'} 
-               ${heading.level > 2 ? `ml-${(heading.level - 2) * 3}` : ''}
+               ${heading.level === 3 ? 'ml-3' : ''}
+               ${heading.level === 4 ? 'ml-6' : ''}
                transition-colors
              `}
  // 简化版的提取标题函数，避免类型问题
  function extractHeadings(content: string): Heading[] {
-   const headingRegex = /^(#{2,4})\s+(.+)$/gm;
+   const headingRegex = /^(#{1,4})\s+(.+)$/gm;
    const headings: Heading[] = [];
    let match;
      const id = generateId(text);
  
+     // 只包含 h2, h3, h4 标题
+     if (level >= 2 && level <= 4) {
        headings.push({ level, text, id });
+     }
    }
  
  // 自定义MDX组件
  export const MDXComponents: MDXComponentsType = {
-   h1: (props: any) => <h1 id={generateId(String(props.children))} {...props} />,
-   h2: (props: any) => <h2 id={generateId(String(props.children))} {...props} />,
-   h3: (props: any) => <h3 id={generateId(String(props.children))} {...props} />,
-   h4: (props: any) => <h4 id={generateId(String(props.children))} {...props} />,
-   a: (props: any) => <Link href={props.href || '#'} {...props} />,
+   h1: (props: any) => {
+     const id = generateId(String(props.children));
+     return <h1 id={id} className="text-3xl font-bold mt-8 mb-4" {...props} />;
+   },
+   h2: (props: any) => {
+     const id = generateId(String(props.children));
+     return <h2 id={id} className="text-2xl font-bold mt-6 mb-3" {...props} />;
+   },
+   h3: (props: any) => {
+     const id = generateId(String(props.children));
+     return <h3 id={id} className="text-xl font-semibold mt-5 mb-2" {...props} />;
+   },
+   h4: (props: any) => {
+     const id = generateId(String(props.children));
+     return <h4 id={id} className="text-lg font-medium mt-4 mb-2" {...props} />;
+   },
+   a: (props: any) => <Link href={props.href || '#'} className="text-blue-600 hover:underline" {...props} />,
    img: (props: any) => (
      <div className="my-6">
```

---

现在我们需要确保 MDX 文件中的内容能够正确地使用我们的 MDX 组件包装器。让我修改 [slug] 页面，确保它正确使用我们的 wrapper 组件：

---

```diff
          components={{
            ...MDXComponents,
-           Image
+           Image,
+           wrapper: MDXComponents.wrapper
          }}
          options={{
```

---

我们需要修复类型错误。让我们尝试另一种方式来确保 MDX 内容使用我们的包装器组件：

---

```diff
        </div>
        
+       <MDXComponents.wrapper>
          <MDXRemote 
            source={content} 
            components={{
              ...MDXComponents,
-           Image,
-           wrapper: MDXComponents.wrapper
+             Image
            }}
            options={{
              parseFrontmatter: true,
            }}
          />
+       </MDXComponents.wrapper>
        
        {data.tags && data.tags.length > 0 && (
```

---

看来我们在使用 wrapper 组件时遇到了类型问题。让我们尝试另一种方法，直接在 MDX 组件中实现目录功能，而不依赖于 wrapper 组件：

---

```diff
  }
  
- // MDX内容包装器组件
- const MDXContentWrapper = ({ children }: { children: React.ReactNode }) => {
+ // 悬浮目录组件
+ export const FloatingTableOfContents = () => {
    const [headings, setHeadings] = useState<Heading[]>([]);
-   const contentRef = useRef<HTMLDivElement>(null);
    
    useEffect(() => {
-     if (contentRef.current) {
      // 从DOM中提取标题
-       const headingElements = contentRef.current.querySelectorAll('h2, h3, h4');
+     const headingElements = document.querySelectorAll('h2, h3, h4');
      const extractedHeadings: Heading[] = [];
      
      
      setHeadings(extractedHeadings);
-     }
-   }, [children]);
+   }, []);
+   
+   if (headings.length === 0) return null;
    
    return (
-     <div className="relative flex flex-col lg:flex-row gap-8">
-       {/* 主要内容区域 */}
-       <div className="prose dark:prose-invert max-w-none lg:w-3/4" ref={contentRef}>
-         {children}
-       </div>
-       
-       {/* 右侧悬浮目录 */}
-       {headings.length > 0 && (
-         <div className="lg:w-1/4">
      <div className="sticky top-24 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg shadow-sm">
        <h2 className="text-xl font-bold mb-4">目录</h2>
        <TableOfContents headings={headings} />
-           </div>
-         </div>
-       )}
      </div>
    );
      <blockquote className="border-l-4 border-blue-500 pl-4 italic" {...props} />
    ),
-   wrapper: (props: any) => <MDXContentWrapper>{props.children}</MDXContentWrapper>,
  };
  
```

---

现在让我们更新文章页面，使用新的悬浮目录组件：

---

```diff
  import { notFound } from 'next/navigation'
  import { MDXRemote } from 'next-mdx-remote/rsc'
- import { MDXComponents } from '@/components/mdx-component'
+ import { MDXComponents, FloatingTableOfContents } from '@/components/mdx-component'
  import matter from 'gray-matter'
  import { Metadata } from 'next'
        </div>
        
-       <MDXComponents.wrapper>
+       <div className="relative flex flex-col lg:flex-row gap-8">
+         <div className="prose dark:prose-invert max-w-none lg:w-3/4">
            <MDXRemote 
              source={content} 
              }}
            />
-       </MDXComponents.wrapper>
            
            {data.tags && data.tags.length > 0 && (
              </div>
            )}
+         </div>
+         
+         <div className="lg:w-1/4">
+           <FloatingTableOfContents />
+         </div>
+       </div>
      </div>
    )
```

---

现在让我们运行开发服务器来测试我们的修复：

---



---



---



---

