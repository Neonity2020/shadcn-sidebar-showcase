<!-- Generated by SpecStory -->

# Supabase Development Guide for NextJS (2025-03-16 07:02:17)

_**User**_

生成一个supabase的开发指南：
1. 如何使用supabase实现NextJS用户注册/登录功能
2. 如何保存用户数据（如我的图书馆项目的图书数据）

---

_**Assistant**_

我来帮您创建一个详细的 Supabase 开发指南。我会创建一个新的 MDX 文件来记录这些内容。


---

```diff
- 
+ # Supabase 开发指南：NextJS 用户认证与数据存储
+ 
+ ## 目录
+ - [用户认证](#用户认证)
+   - [设置 Supabase 客户端](#设置-supabase-客户端)
+   - [用户注册](#用户注册)
+   - [用户登录](#用户登录)
+   - [用户登出](#用户登出)
+ - [数据存储](#数据存储)
+   - [创建数据表](#创建数据表)
+   - [插入数据](#插入数据)
+   - [查询数据](#查询数据)
+   - [更新数据](#更新数据)
+   - [删除数据](#删除数据)
+ 
+ ## 用户认证
+ 
+ ### 设置 Supabase 客户端
+ 
+ 首先，安装必要的依赖：
+ 
+ ```bash
+ npm install @supabase/supabase-js @supabase/auth-helpers-nextjs
+ ```
+ 
+ 创建 Supabase 客户端配置文件：
+ 
+ ```typescript
+ // lib/supabase.ts
+ import { createClient } from '@supabase/supabase-js'
+ 
+ const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
+ const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
+ 
+ export const supabase = createClient(supabaseUrl, supabaseAnonKey)
+ ```
+ 
+ 在 `.env.local` 文件中添加环境变量：
+ 
+ ```bash
+ NEXT_PUBLIC_SUPABASE_URL=你的_SUPABASE_URL
+ NEXT_PUBLIC_SUPABASE_ANON_KEY=你的_SUPABASE_ANON_KEY
+ ```
+ 
+ ### 用户注册
+ 
+ ```typescript
+ // 注册新用户
+ const signUp = async (email: string, password: string) => {
+   const { data, error } = await supabase.auth.signUp({
+     email,
+     password,
+   })
+   
+   if (error) throw error
+   return data
+ }
+ ```
+ 
+ ### 用户登录
+ 
+ ```typescript
+ // 用户登录
+ const signIn = async (email: string, password: string) => {
+   const { data, error } = await supabase.auth.signInWithPassword({
+     email,
+     password,
+   })
+   
+   if (error) throw error
+   return data
+ }
+ ```
+ 
+ ### 用户登出
+ 
+ ```typescript
+ // 用户登出
+ const signOut = async () => {
+   const { error } = await supabase.auth.signOut()
+   if (error) throw error
+ }
+ ```
+ 
+ ## 数据存储
+ 
+ ### 创建数据表
+ 
+ 在 Supabase 控制台中创建数据表。以图书馆项目为例，创建 books 表：
+ 
+ ```sql
+ create table books (
+   id uuid default uuid_generate_v4() primary key,
+   user_id uuid references auth.users not null,
+   title text not null,
+   author text not null,
+   isbn text,
+   created_at timestamp with time zone default timezone('utc'::text, now()) not null,
+   updated_at timestamp with time zone default timezone('utc'::text, now()) not null
+ );
+ 
+ -- 设置 RLS（行级安全）
+ alter table books enable row level security;
+ 
+ -- 创建策略：用户只能访问自己的数据
+ create policy "Users can only access their own books"
+   on books for all
+   using (auth.uid() = user_id);
+ ```
+ 
+ ### 插入数据
+ 
+ ```typescript
+ // 添加新书
+ const addBook = async (bookData: {
+   title: string;
+   author: string;
+   isbn?: string;
+ }) => {
+   const { data, error } = await supabase
+     .from('books')
+     .insert([bookData])
+     .select()
+   
+   if (error) throw error
+   return data
+ }
+ ```
+ 
+ ### 查询数据
+ 
+ ```typescript
+ // 获取用户的所有书籍
+ const getBooks = async () => {
+   const { data, error } = await supabase
+     .from('books')
+     .select('*')
+     .order('created_at', { ascending: false })
+   
+   if (error) throw error
+   return data
+ }
+ 
+ // 根据 ID 获取单本书
+ const getBookById = async (id: string) => {
+   const { data, error } = await supabase
+     .from('books')
+     .select('*')
+     .eq('id', id)
+     .single()
+   
+   if (error) throw error
+   return data
+ }
+ ```
+ 
+ ### 更新数据
+ 
+ ```typescript
+ // 更新书籍信息
+ const updateBook = async (id: string, updates: {
+   title?: string;
+   author?: string;
+   isbn?: string;
+ }) => {
+   const { data, error } = await supabase
+     .from('books')
+     .update(updates)
+     .eq('id', id)
+     .select()
+   
+   if (error) throw error
+   return data
+ }
+ ```
+ 
+ ### 删除数据
+ 
+ ```typescript
+ // 删除书籍
+ const deleteBook = async (id: string) => {
+   const { error } = await supabase
+     .from('books')
+     .delete()
+     .eq('id', id)
+   
+   if (error) throw error
+ }
+ ```
+ 
+ ## 最佳实践
+ 
+ 1. **错误处理**：始终检查并处理 Supabase 操作返回的错误。
+ 2. **类型安全**：使用 TypeScript 定义数据模型和接口。
+ 3. **实时订阅**：对于需要实时更新的数据，可以使用 Supabase 的实时订阅功能。
+ 4. **安全性**：利用 RLS 策略确保数据安全。
+ 5. **性能优化**：使用适当的索引和查询优化来提高性能。
+ 
+ ## 示例：完整的图书管理组件
+ 
+ ```typescript
+ // components/BookManager.tsx
+ import { useState, useEffect } from 'react'
+ import { supabase } from '../lib/supabase'
+ 
+ interface Book {
+   id: string
+   title: string
+   author: string
+   isbn?: string
+ }
+ 
+ export default function BookManager() {
+   const [books, setBooks] = useState<Book[]>([])
+   const [loading, setLoading] = useState(true)
+ 
+   useEffect(() => {
+     fetchBooks()
+   }, [])
+ 
+   const fetchBooks = async () => {
+     try {
+       const { data, error } = await supabase
+         .from('books')
+         .select('*')
+         .order('created_at', { ascending: false })
+       
+       if (error) throw error
+       setBooks(data)
+     } catch (error) {
+       console.error('Error fetching books:', error)
+     } finally {
+       setLoading(false)
+     }
+   }
+ 
+   const handleAddBook = async (e: React.FormEvent<HTMLFormElement>) => {
+     e.preventDefault()
+     const formData = new FormData(e.currentTarget)
+     
+     try {
+       const { error } = await supabase
+         .from('books')
+         .insert([{
+           title: formData.get('title'),
+           author: formData.get('author'),
+           isbn: formData.get('isbn')
+         }])
+       
+       if (error) throw error
+       fetchBooks()
+       e.currentTarget.reset()
+     } catch (error) {
+       console.error('Error adding book:', error)
+     }
+   }
+ 
+   if (loading) return <div>加载中...</div>
+ 
+   return (
+     <div>
+       <h2>我的图书馆</h2>
+       
+       <form onSubmit={handleAddBook}>
+         <input name="title" placeholder="书名" required />
+         <input name="author" placeholder="作者" required />
+         <input name="isbn" placeholder="ISBN" />
+         <button type="submit">添加书籍</button>
+       </form>
+ 
+       <div>
+         {books.map(book => (
+           <div key={book.id}>
+             <h3>{book.title}</h3>
+             <p>作者：{book.author}</p>
+             {book.isbn && <p>ISBN：{book.isbn}</p>}
+           </div>
+         ))}
+       </div>
+     </div>
+   )
+ }
+ ```
+ 
+ 这个指南涵盖了在 NextJS 项目中使用 Supabase 进行用户认证和数据存储的主要方面。通过遵循这些步骤和最佳实践，你可以构建一个安全、可扩展的应用程序。记住要根据你的具体需求调整代码和配置。
+ 
```

---

我已经为您创建了一个详细的 Supabase 开发指南，包含了以下主要内容：

1. **用户认证部分**：
   - Supabase 客户端设置
   - 用户注册功能
   - 用户登录功能
   - 用户登出功能

2. **数据存储部分**：
   - 数据表创建（以图书馆项目为例）
   - 数据的增删改查操作
   - 行级安全（RLS）策略设置

3. **最佳实践**：
   - 错误处理
   - 类型安全
   - 实时订阅
   - 安全性考虑
   - 性能优化

4. **完整示例**：
   - 提供了一个完整的图书管理组件示例，展示了如何在实际应用中使用 Supabase

这个指南已经保存在 `app/(pages)/content/blog/supabase-guide.mdx` 文件中。您可以根据需要查看和修改这个文档。如果您需要对某个特定部分进行更详细的说明，或者需要添加其他功能，请告诉我。

---



---

